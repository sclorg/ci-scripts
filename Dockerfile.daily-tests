FROM quay.io/fedora/fedora:42

ENV SHARED_DIR="/var/ci-scripts" \
    VERSION="42" \
    RELEASE_UPSTREAM="0.6.4" \
    UPSTREAM_TMT_REPO="https://github.com/sclorg/sclorg-testing-farm" \
    UPSTREAM_TMT_DIR="sclorg-testing-farm" \
    HOME="/home/nightly" \
    SUMMARY="Daily tests for SCL org projects" \
    DESCRIPTION="This image is used to run daily tests for SCL org projects in CI." \
    NAME="nightly" \
    WORK_DIR="/home/nightly/ci-scripts"

LABEL summary="${SUMMARY}" \
      description="${DESCRIPTION}" \
      io.k8s.description="${DESCRIPTION}" \
      io.k8s.display-name="SCL org Daily Tests" \
      io.k8s.vendor="SCL org" \
      architecture="x86_64"

RUN dnf install -y python3.13-pip git nss_wrapper && \
    dnf clean all

COPY requirements.sh "${WORK_DIR}/requirements.sh"
RUN bash "${WORK_DIR}/requirements.sh"
RUN cd "${WORK_DIR}" && git clone "${UPSTREAM_TMT_REPO}" "${UPSTREAM_TMT_DIR}"

COPY . /root/ci-scripts
WORKDIR "${HOME}"

# USER 900

CMD ["/root/ci-scripts/run_nightly_tests.sh"]
